define("authentication/app",["angular","authentication/controller/login","authentication/controller/register","authentication/service"],function(t){return t.module("app.authentication",["app.authentication.controller.login","app.authentication.controller.register","app.authentication.services"])}),define("app/account",["angular","account/controller/avatar","account/controller/password","account/controller/account","account/controller/word","settings/word/service"],function(t){return t.module("app.account",["app.account.controller.avatar","app.account.controller.password","app.account.controller.account","app.account.controller.word","app.settings.word.service"])}),define("components/cropper/directive",["angular","underscore","cropper","components/snackbar/service","authentication/service"],function(t,e){return t.module("app.component.cropper",[]).directive("croperPhoto",["$rootScope","$compile","$parse","$timeout","Snackbar","Authentication",function(t,e,n,r,o,a){return{restrict:"EA",templateUrl:"/static/templates/components/cropper.html",scope:{imageUrl:"@"},link:function(e,n){var r=n.find("#_cropper-container > img"),c=n.find("#fileInput");r.attr("src",e.imageUrl),r.cropper({aspectRatio:1,preview:".account-head-pic",checkImageOrigin:!1,crop:function(t){},built:function(){}}),c.change(function(){var n=this.files[0];return"image/bmp"!=n.type&&"image/jpg"!=n.type&&"image/jpeg"!=n.type&&"image/png"!=n.type?void o.error("图片文件格式不支持，请选择bmp、jpeg、jpg、png格式！"):n.size>1048576?void o.error("图片文件大小超过1M!"):(a.uploadImage(n).then(function(n){result=n.data,result?(e.imageUrl=result.avatar,o.show("头像上传成功!"),t.currentUser=result):o.error("错误:"+n.errors)},function(){}),void c.val(""))}),e.changeImage=function(t){t.stopPropagation(),t.preventDefault(),c.click()},e.$watch("imageUrl",function(t,e){t!==e&&r.cropper("replace",t)})}}}])}),define("components/navbar/directive",["angular","underscore","cropper","components/snackbar/service","authentication/service"],function(t,e){return t.module("app.component.navbar",[]).directive("navBar",["$compile","$parse","$timeout","Snackbar","Authentication",function(t,e,n,r,o){return{restrict:"EA",templateUrl:"/static/templates/components/navbar.html",controller:"NavbarController",controllerAs:"vm"}}])}),define("components/module",["angular","components/cropper/directive","components/snackbar/service","components/navbar/directive"],function(t){return t.module("app.components",["app.component.cropper","app.services.snackbar","app.component.navbar"])}),define("components/snackbar/service",["angular","jquery","underscore","snackbar"],function(t,e,n){function r(){function t(t,r){r=n.extend({timeout:3e3,htmlAllowed:!0},r),r.content=t,e.snackbar(r)}function r(e,n){t("错误: "+e,n)}function o(e,n){t(e,n)}var a={error:r,show:o};return a}return t.module("app.services.snackbar",[]).factory("Snackbar",r)}),define("app/word",["angular","word/service","word/word/controller","word/detail/controller"],function(t){return t.module("app.word",["app.word.services","app.word.word.controllers","app.word.detail.controllers"])}),define("word/service",["angular"],function(t){return t.module("app.word.services",[]).factory("Word",["$http","$q",function(t,e){return{getWordList:function(n){var r=e.defer();return t.get("/api/v1/user/words/",{params:{page:n||1}}).success(function(t){r.resolve(t.results)}).error(function(t){r.reject(t)}),r.promise},getWordExample:function(n){var r=e.defer();return t.get("/api/v1/examples/?word_id="+n).success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},getNote:function(n){var r=e.defer();return t.get("/api/v1/notes/?word_id="+n).success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},getMyNote:function(n){var r=e.defer();return t.get("/api/v1/notes/?word_id="+n+"&my=1").success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},createNote:function(e,n){var r=t.post("/api/v1/notes/?word_id="+e,{word_id:e,content:n});return r},updateNote:function(e,n){var r=t.put("/api/v1/notes/"+e,{content:n});return r},deleteNote:function(e){var n=t["delete"]("/api/v1/notes/"+e);return n}}}])}),define("layout/app",["angular","layout/navbar/controller"],function(t){return t.module("app.layout",["app.layout.controllers"])}),define("authentication/service",["angular","ngCookies","components/snackbar/service"],function(t){return t.module("app.authentication.services",["ngCookies"]).factory("Authentication",["$cookies","$http","$q","$location","$state","$window","Snackbar","$timeout","$rootScope",function(e,n,r,o,a,c,i,u,s){function l(t){b=t}function p(){return b}function d(t,e,r){function o(n,r,o,a){f(t,e)}function a(t,e,n,r){console.log("register failed"),i.show(t.data.message)}return t&&e&&r?n.post("/api/v1/accounts/",{username:r,password:e,email:t}).then(o,a):i.show("邮箱、用户名、密码无法为空!")}function f(t,e){function r(t,e,n,r){i.show("登陆成功!"),u(function(){var e=o.search();e.redirect||"/";s.$apply(function(){s.currentUser=t.data}),a.go("word",{},{reload:!0})},1e3)}function c(t,e,n,r){i.error("错误:"+t.data)}return n.post("/api/v1/auth/login/",{email:t,password:e}).then(r,c)}function m(){function t(t,e,n,r){s.currentUser=null,a.go("login",{},{reload:!0})}function e(t,e,n,r){console.error("logout failure!")}return n.post("/api/v1/auth/logout/").then(t,e)}function g(){return!!b}function w(e){var r=new FormData;r.append("avatar",e);var o=n.post("/account/uploadimage/",r,{transformRequest:t.identity,headers:{"Content-Type":void 0}});return o}function h(t,e){return n.put("/api/v1/accounts/"+b.id+"/",{password:t,confirm_password:e}).then(function(t,e){i.show("密码更新成功，请重新登陆！"),u(function(){m()},3e3)},function(){i.show("错误:更新失败!")})}function v(t){var e=r.defer();return n.post("/account/checkpassword/",{password:t}).success(function(t){e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}var b;return{register:d,login:f,logout:m,isAuthenticatedAccount:g,getCurrentUser:p,setCurrentUser:l,uploadImage:w,checkUserPassword:v,changePassword:h}}])}),define("authentication/controller/login",["angular","ngCookies","authentication/service","components/snackbar/service"],function(){return angular.module("app.authentication.controller.login",[]).controller("LoginController",["$location","$scope","Authentication","Snackbar",function(t,e,n,r){var o=this;o.login=function(){n.login(o.email,o.password)}}])}),define("authentication/controller/register",["angular","ngCookies","authentication/service"],function(t){return t.module("app.authentication.controller.register",[]).controller("RegisterController",["$location","$scope","Authentication",function(t,e,n){var r=this;r.register=function(){n.register(r.email,r.password,r.username)}}])}),define("account/controller/account",["angular","components/cropper/directive","authentication/service"],function(){return angular.module("app.account.controller.account",[]).controller("AccountController",function(t,e){$rootScope.$watch("currentUser",function(n,r){t.user=e.getCurrentUser()})})}),define("account/controller/avatar",["angular","components/cropper/directive","authentication/service"],function(){return angular.module("app.account.controller.avatar",[]).controller("AvatarController",function(t,e){t.user=e.getCurrentUser()})}),define("account/controller/password",["angular","authentication/service","components/snackbar/service"],function(){return angular.module("app.account.controller.password",[]).controller("PassWordController",function(t,e,n){t.is_correct=!1,t.is_ok=!1,t.user={oldPwd:"",newPwd:"",cfmPwd:""},t.checkPassword=function(){e.checkUserPassword(t.user.oldPwd).then(function(e){e.success?(n.show("密码输入正确!"),t.is_correct=!0):(n.show("错误:请输入正确的密码!"),t.is_correct=!1)})},t.changePassword=function(){e.changePassword(t.user.newPwd,t.user.cfmPwd)},t.$watch("user.newPwd+user.cfmPwd",function(e,r){t.user.newPwd&&t.user.cfmPwd&&t.user.newPwd==t.user.cfmPwd?t.is_ok=!0:(t.is_ok=!1,t.user.newPwd&&t.user.cfmPwd&&n.error("错误:输入的两次密码不相同!"))})})}),define("account/controller/word",["angular","authentication/service","settings/word/service","components/snackbar/service"],function(){return angular.module("app.account.controller.word",[]).controller("WordSettingController",function(t,e,n,r,o,a){function c(t,e){var n=null;return e&&t.forEach(function(t,r){t.id!=e||n||(n=t)}),n}e.user=t.currentUser,t.$watch("currentUser",function(n,r){e.user=t.currentUser}),r.getWordOptions().then(function(t){e.options=t,e.level=c(t.levels,e.user.level)||null,e.word_num=c(t.word_num,e.user.word_num)||null}),e.$watch("level",function(t,e){}),e.$watch("word_num",function(t,e){}),e.changeWordOptions=function(){return e.level?void r.updateWordOptions(e.level.id,e.word_num.id):o.error("请选择学习的内容")},t.$watch("currentUser",function(n,r){e.user=t.currentUser,null===e.user&&a.go("login")})})}),define("settings/word/service",["angular","components/snackbar/service"],function(t){return t.module("app.settings.word.service",[]).factory("WordOptions",["$rootScope","$http","$q","Snackbar",function(t,e,n,r){return{getWordOptions:function(t){var r=n.defer();return e.get("/api/v1/options/").success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},updateWordOptions:function(o,a){var c=n.defer();return e.post("/api/v1/options/",{level:o||null,word_num:a||null}).success(function(e){c.resolve(e),t.currentUser=e,r.show("设置修改成功")}).error(function(t){c.reject(t),r.error("设置修改失败")}),c.promise}}}])}),define("word/detail/controller",["angular","ngSanitize","authentication/service","word/service","components/snackbar/service","settings/word/service"],function(t){return t.module("app.word.detail.controllers",["ngSanitize"]).controller("WordDetailController",["$scope","$rootScope","Authentication","Word","$stateParams","Snackbar","WordOptions","$uibModal","$filter",function(e,n,r,o,a,c,i,u,s){function l(t){o.getMyNote(t).then(function(t){e.mynotes=t})}function p(t){o.getWordExample(t).then(function(t){e.examples=t})}function d(t,e){var n=null;return e&&t.forEach(function(t,r){t.id!=e||n||(n=t)}),n}var f=null;n.$watch("currentUser",function(t,r){e.user=n.currentUser,i.getWordOptions().then(function(t){e.options=t,e.word_num=d(t.word_num,e.user.word_num)||null})}),e.currentIndex=0,e.$watch("currentIndex",function(t,n){isNaN(t)||t%10!=0?(e.word=e.words[e.currentIndex-10*Math.floor(t/10)],p(e.word.id),l(e.word.id)):o.getWordList(t/10+1).then(function(n){e.words=n,e.word=e.words[e.currentIndex-10*Math.floor(t/10)],p(e.word.id),l(e.word.id)},function(){c.error("没有更多的单词了")})}),e.fetchNote=function(){e.onLoad=!0;var t=e.word.id;o.getNote(t).then(function(t){e.onLoad=!1,e.notes=t})},e.changeIndex=function(){e.currentIndex==e.word_num.num?c.show("完成今日单词背诵!"):(e.currentIndex++,e.model.tabIndex=0)},e.playAudio=function(t){f=new Audio(t),f.play(),f=null},e.model={content:"",tabIndex:0},e.createNote=function(){e.model.content?o.createNote(e.word.id,e.model.content).then(function(t){result=t.data,result?(c.show("你的笔记创建成功!"),e.mynotes.unshift(result),e.model.content="",e.model.tabIndex=0):c.error("错误:"+t.errors)},function(){c.error("服务器出错!")}):c.show("笔记不能为空")},e.open=function(n){var r=u.open({animation:!0,templateUrl:"myModalContent.html",controller:function(e,r,o){var a=t.copy(n);e.content={note:a},e.ok=function(){e.content.note.content&&o.updateNote(n.id,e.content.note.content).then(function(t){n.content=t.data.content,c.show("你的笔记修改成功!"),r.close()})},e.cancel=function(){r.dismiss("cancel")},e["delete"]=function(){o.deleteNote(n.id).then(function(t){console.log(t),204==t.status&&(c.show("你的笔记删除成功!"),r.close("delete"))})}}});r.result.then(function(t){if("delete"==t){var r=s("filter")(e.mynotes,{id:n.id}),o=e.mynotes.indexOf(r[0]);o>-1&&e.mynotes.splice(o,1)}},function(){})}}])}),define("word/word/controller",["angular","ngSanitize","authentication/service","word/service","components/snackbar/service"],function(t){return t.module("app.word.word.controllers",["ngSanitize"]).controller("WordController",["$scope","$rootScope","Authentication","Word","$stateParams","Snackbar","WordOptions",function(t,e,n,r,o,a,c){function i(t,e){var n=null;return e&&t.forEach(function(t,r){t.id!=e||n||(n=t)}),n}e.$watch("currentUser",function(n,r){t.user=e.currentUser}),e.$watch("currentUser",function(n,r){t.user=e.currentUser,c.getWordOptions().then(function(e){t.options=e,t.word_num=i(e.word_num,t.user.word_num)||{}})})}])}),define("layout/navbar/controller",["angular","authentication/service"],function(t){return t.module("app.layout.controllers",[]).controller("NavbarController",["$rootScope","$scope","$state","Authentication",function(t,e,n,r){var o=this;o.logout=function(){r.logout()},o.searchWord=function(){Word.serachWord(o.words).then(function(t){})},t.$watch("currentUser",function(e,n){o.user=t.currentUser,o.is_authenticate=t.currentUser})}])}),define("app",["angular","ngAnimate","uiBootstrapTpls","layout/app","authentication/app","app/account","app/routes","components/module","app/word"],function(t){return t.module("app",["ui.bootstrap","app.routes","ngAnimate","app.authentication","app.layout","app.components","app.account","app.word"])}),define("app/routes",["angular","uiRouter"],function(t){t.module("app.routes",["ui.router"]).config(function(t,e){t.state("register",{url:"/register",controller:"RegisterController",controllerAs:"vm",templateUrl:"/static/templates/authentication/register.html"}).state("login",{url:"/login?redirect",controller:"LoginController",controllerAs:"loginCtrl",templateUrl:"/static/templates/authentication/login.html"}).state("settings",{url:"/settings",templateUrl:"/static/templates/account/settings.html"}).state("settings.word",{url:"/word",templateUrl:"/static/templates/account/settings/settings-word.html",controller:"WordSettingController"}).state("settings.avatar",{url:"/avatar",templateUrl:"/static/templates/account/settings/settings-avatar.html",controller:"AvatarController"}).state("settings.password",{url:"/password",templateUrl:"/static/templates/account/settings/settings-password.html",controller:"PassWordController"}).state("settings.feedback",{url:"/feedback",templateUrl:"/static/templates/account/settings/settings-feedback.html"}).state("search",{url:"/search?search",templateUrl:"/static/templates/course/explore.html",controller:"SearchController"}).state("word",{url:"/word",templateUrl:"/static/templates/word/word.html",controller:"WordController"}).state("detail",{url:"/detail",templateUrl:"/static/templates/word/detail.html",controller:"WordDetailController"}),e.otherwise("login")})}),requirejs.config({paths:{underscore:"/static/build/underscore",jquery:"/static/build/jquery",angular:"/static/build/angular",uiRouter:"/static/build/angular-ui-router",uiBootstrap:"/static/build/ui-bootstrap.min",uiBootstrapTpls:"/static/build/ui-bootstrap-tpls.min",cropper:"/static/build/cropper.min",ngAnimate:"/static/build/angular-animate",ngAria:"/static/build/angular-aria",ngCookies:"/static/build/angular-cookies",ngSanitize:"/static/build/angular-sanitize",app:"/static/javascripts/app",snackbar:"/static/build/snackbar.min"},shim:{angular:{deps:["jquery"],exports:"angular"},uiBootstrapTpls:["angular","uiBootstrap"],uiBootstrap:["angular","ngAnimate","ngAria"],ngAnimate:["angular"],ngAria:["angular"],ngSanitize:["angular"],uiRouter:["angular"],ngCookies:["angular"],cropper:["jquery"],snackbar:["jquery"],underscore:{exports:"_"}}}),require(["app"],function(){angular.element().ready(function(){$.get("/account/currentuser/").success(function(t,e){var n=t,r=angular.module("app");r.run(["Authentication","$http","$rootScope",function(t,e,r){e.defaults.xsrfHeaderName="X-CSRFToken",e.defaults.xsrfCookieName="csrftoken",r.currentUser=n,t.setCurrentUser(n)}]),angular.bootstrap(document,["app"])}).error(function(t){var e="",n=angular.module("app");n.run(["Authentication","$http","$rootScope","$state",function(t,n,r,o){n.defaults.xsrfHeaderName="X-CSRFToken",n.defaults.xsrfCookieName="csrftoken",r.currentUser=e,t.setCurrentUser(e),o.go("login")}]),angular.bootstrap(document,["app"])})})}),define("main",[],function(){});