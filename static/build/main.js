define("authentication/app",["angular","authentication/controller/login","authentication/controller/register","authentication/service"],function(e){return e.module("app.authentication",["app.authentication.controller.login","app.authentication.controller.register","app.authentication.services"])}),define("app/account",["angular","account/controller/avatar","account/controller/password","account/controller/account","account/controller/word","settings/word/service"],function(e){return e.module("app.account",["app.account.controller.avatar","app.account.controller.password","app.account.controller.account","app.account.controller.word","app.settings.word.service"])}),define("components/cropper/directive",["angular","underscore","cropper","components/snackbar/service","authentication/service"],function(e,t){return e.module("app.component.cropper",[]).directive("croperPhoto",["$rootScope","$compile","$parse","$timeout","Snackbar","Authentication",function(e,t,n,r,o,a){return{restrict:"EA",templateUrl:"/static/templates/components/cropper.html",scope:{imageUrl:"@"},link:function(t,n){var r=n.find("#_cropper-container > img"),c=n.find("#fileInput");r.attr("src",t.imageUrl),r.cropper({aspectRatio:1,preview:".account-head-pic",checkImageOrigin:!1,crop:function(e){},built:function(){}}),c.change(function(){var n=this.files[0];return"image/bmp"!=n.type&&"image/jpg"!=n.type&&"image/jpeg"!=n.type&&"image/png"!=n.type?void o.error("图片文件格式不支持，请选择bmp、jpeg、jpg、png格式！"):n.size>1048576?void o.error("图片文件大小超过1M!"):(a.uploadImage(n).then(function(n){result=n.data,result?(t.imageUrl=result.avatar,o.show("头像上传成功!"),e.currentUser=result):o.error("错误:"+n.errors)},function(){}),void c.val(""))}),t.changeImage=function(e){e.stopPropagation(),e.preventDefault(),c.click()},t.$watch("imageUrl",function(e,t){e!==t&&r.cropper("replace",e)})}}}])}),define("components/navbar/directive",["angular","underscore","cropper","components/snackbar/service","authentication/service"],function(e,t){return e.module("app.component.navbar",[]).directive("navBar",["$compile","$parse","$timeout","Snackbar","Authentication",function(e,t,n,r,o){return{restrict:"EA",templateUrl:"/static/templates/components/navbar.html",controller:"NavbarController",controllerAs:"vm"}}])}),define("components/module",["angular","components/cropper/directive","components/snackbar/service","components/navbar/directive"],function(e){return e.module("app.components",["app.component.cropper","app.services.snackbar","app.component.navbar"])}),define("components/snackbar/service",["angular","jquery","underscore","snackbar"],function(e,t,n){function r(){function e(e,r){r=n.extend({timeout:3e3,htmlAllowed:!0},r),r.content=e,t.snackbar(r)}function r(t,n){e("错误: "+t,n)}function o(t,n){e(t,n)}var a={error:r,show:o};return a}return e.module("app.services.snackbar",[]).factory("Snackbar",r)}),define("app/word",["angular","word/service","word/word/controller","word/detail/controller"],function(e){return e.module("app.word",["app.word.services","app.word.word.controllers","app.word.detail.controllers"])}),define("word/service",["angular"],function(e){return e.module("app.word.services",[]).factory("Word",["$http","$q",function(e,t){return{getWordList:function(n){var r=t.defer();return e.get("/api/v1/user/words/",{params:{page:n||1}}).success(function(e){r.resolve(e.results)}).error(function(e){r.reject(e)}),r.promise},getWordExample:function(n){var r=t.defer();return e.get("/api/v1/examples/?word_id="+n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getNote:function(n){var r=t.defer();return e.get("/api/v1/notes/?word_id="+n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getMyNote:function(n){var r=t.defer();return e.get("/api/v1/notes/?word_id="+n+"&my=1").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},createNote:function(t,n){var r=e.post("/api/v1/notes/?word_id="+t,{word_id:t,content:n});return r},updateNote:function(t,n){var r=e.put("/api/v1/notes/"+t,{content:n});return r},deleteNote:function(t){var n=e["delete"]("/api/v1/notes/"+t);return n}}}])}),define("layout/app",["angular","layout/navbar/controller"],function(e){return e.module("app.layout",["app.layout.controllers"])}),define("authentication/service",["angular","ngCookies","components/snackbar/service"],function(e){return e.module("app.authentication.services",["ngCookies"]).factory("Authentication",["$cookies","$http","$q","$location","$state","$window","Snackbar","$timeout","$rootScope",function(t,n,r,o,a,c,i,u,s){function l(e){b=e}function p(){return b}function d(e,t,r){function o(n,r,o,a){f(e,t)}function a(e,t,n,r){console.log("register failed"),i.show(e.data.message)}return e&&t&&r?n.post("/api/v1/accounts/",{username:r,password:t,email:e}).then(o,a):i.show("邮箱、用户名、密码无法为空!")}function f(e,t){function r(e,t,n,r){i.show("登陆成功!"),u(function(){var t=o.search();t.redirect||"/";s.$apply(function(){s.currentUser=e.data}),a.go("word",{},{reload:!0})},1e3)}function c(e,t,n,r){i.error("错误:"+e.data)}return n.post("/api/v1/auth/login/",{email:e,password:t}).then(r,c)}function m(){function e(e,t,n,r){s.currentUser=null,a.go("login",{},{reload:!0})}function t(e,t,n,r){console.error("logout failure!")}return n.post("/api/v1/auth/logout/").then(e,t)}function g(){return!!b}function w(t){var r=new FormData;r.append("avatar",t);var o=n.post("/account/uploadimage/",r,{transformRequest:e.identity,headers:{"Content-Type":void 0}});return o}function h(e,t){return n.put("/api/v1/accounts/"+b.id+"/",{password:e,confirm_password:t}).then(function(e,t){i.show("密码更新成功，请重新登陆！"),u(function(){m()},3e3)},function(){i.show("错误:更新失败!")})}function v(e){var t=r.defer();return n.post("/account/checkpassword/",{password:e}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}var b;return{register:d,login:f,logout:m,isAuthenticatedAccount:g,getCurrentUser:p,setCurrentUser:l,uploadImage:w,checkUserPassword:v,changePassword:h}}])}),define("authentication/controller/login",["angular","ngCookies","authentication/service","components/snackbar/service"],function(){return angular.module("app.authentication.controller.login",[]).controller("LoginController",["$location","$scope","Authentication","Snackbar",function(e,t,n,r){var o=this;o.login=function(){n.login(o.email,o.password)}}])}),define("authentication/controller/register",["angular","ngCookies","authentication/service"],function(e){return e.module("app.authentication.controller.register",[]).controller("RegisterController",["$location","$scope","Authentication",function(e,t,n){var r=this;r.register=function(){n.register(r.email,r.password,r.username)}}])}),define("account/controller/account",["angular","components/cropper/directive","authentication/service"],function(){return angular.module("app.account.controller.account",[]).controller("AccountController",function(e,t){$rootScope.$watch("currentUser",function(n,r){e.user=t.getCurrentUser()})})}),define("account/controller/avatar",["angular","components/cropper/directive","authentication/service"],function(){return angular.module("app.account.controller.avatar",[]).controller("AvatarController",function(e,t){e.user=t.getCurrentUser()})}),define("account/controller/password",["angular","authentication/service","components/snackbar/service"],function(){return angular.module("app.account.controller.password",[]).controller("PassWordController",function(e,t,n){e.is_correct=!1,e.is_ok=!1,e.user={oldPwd:"",newPwd:"",cfmPwd:""},e.checkPassword=function(){t.checkUserPassword(e.user.oldPwd).then(function(t){t.success?(n.show("密码输入正确!"),e.is_correct=!0):(n.show("错误:请输入正确的密码!"),e.is_correct=!1)})},e.changePassword=function(){t.changePassword(e.user.newPwd,e.user.cfmPwd)},e.$watch("user.newPwd+user.cfmPwd",function(t,r){e.user.newPwd&&e.user.cfmPwd&&e.user.newPwd==e.user.cfmPwd?e.is_ok=!0:(e.is_ok=!1,e.user.newPwd&&e.user.cfmPwd&&n.error("错误:输入的两次密码不相同!"))})})}),define("account/controller/word",["angular","authentication/service","settings/word/service","components/snackbar/service"],function(){return angular.module("app.account.controller.word",[]).controller("WordSettingController",function(e,t,n,r,o,a){function c(e,t){var n=null;return t&&e.forEach(function(e,r){e.id!=t||n||(n=e)}),n}t.user=e.currentUser,e.$watch("currentUser",function(n,r){t.user=e.currentUser}),r.getWordOptions().then(function(e){t.options=e,t.level=c(e.levels,t.user.level)||null,t.word_num=c(e.word_num,t.user.word_num)||null}),t.$watch("level",function(e,t){}),t.$watch("word_num",function(e,t){}),t.changeWordOptions=function(){return t.level?void r.updateWordOptions(t.level.id,t.word_num.id):o.error("请选择学习的内容")},e.$watch("currentUser",function(n,r){t.user=e.currentUser,null===t.user&&a.go("login")})})}),define("settings/word/service",["angular","components/snackbar/service"],function(e){return e.module("app.settings.word.service",[]).factory("WordOptions",["$rootScope","$http","$q","Snackbar",function(e,t,n,r){return{getWordOptions:function(e){var r=n.defer();return t.get("/api/v1/options/").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},updateWordOptions:function(o,a){var c=n.defer();return t.post("/api/v1/options/",{level:o||null,word_num:a||null}).success(function(t){c.resolve(t),e.currentUser=t,r.show("设置修改成功")}).error(function(e){c.reject(e),r.error("设置修改失败")}),c.promise}}}])}),define("word/detail/controller",["angular","ngSanitize","authentication/service","word/service","components/snackbar/service","settings/word/service"],function(e){return e.module("app.word.detail.controllers",["ngSanitize"]).controller("WordDetailController",["$scope","$rootScope","Authentication","Word","$stateParams","Snackbar","WordOptions","$uibModal","$filter",function(t,n,r,o,a,c,i,u,s){function l(e){o.getMyNote(e).then(function(e){t.mynotes=e})}function p(e){o.getWordExample(e).then(function(e){t.examples=e})}function d(e,t){var n=null;return t&&e.forEach(function(e,r){e.id!=t||n||(n=e)}),n}var f=null;n.$watch("currentUser",function(e,r){t.user=n.currentUser,i.getWordOptions().then(function(e){t.options=e,t.word_num=d(e.word_num,t.user.word_num)||null})}),t.currentIndex=0,t.$watch("currentIndex",function(e,n){isNaN(e)||e%10!=0?(t.word=t.words[t.currentIndex-10*Math.floor(e/10)],p(t.word.id),l(t.word.id)):o.getWordList(e/10+1).then(function(n){t.words=n,t.word=t.words[t.currentIndex-10*Math.floor(e/10)],p(t.word.id),l(t.word.id)},function(){c.error("没有更多的单词了")})}),t.fetchNote=function(){t.onLoad=!0;var e=t.word.id;o.getNote(e).then(function(e){t.onLoad=!1,t.notes=e})},t.changeIndex=function(){t.currentIndex==t.word_num.num?c.show("完成今日单词背诵!"):(t.currentIndex++,t.model.tabIndex=0)},t.playAudio=function(e){f=new Audio(e),f.play(),f=null},t.model={content:"",tabIndex:0},t.createNote=function(){t.model.content?o.createNote(t.word.id,t.model.content).then(function(e){result=e.data,result?(c.show("你的笔记创建成功!"),t.mynotes.unshift(result),t.model.content="",t.model.tabIndex=0):c.error("错误:"+e.errors)},function(){c.error("服务器出错!")}):c.show("笔记不能为空")},t.open=function(n){var r=u.open({animation:!0,templateUrl:"myModalContent.html",controller:function(t,r,o){var a=e.copy(n);t.content={note:a},t.ok=function(){t.content.note.content&&o.updateNote(n.id,t.content.note.content).then(function(e){n.content=e.data.content,c.show("你的笔记修改成功!"),r.close()})},t.cancel=function(){r.dismiss("cancel")},t["delete"]=function(){o.deleteNote(n.id).then(function(e){console.log(e),204==e.status&&(c.show("你的笔记删除成功!"),r.close("delete"))})}}});r.result.then(function(e){if("delete"==e){var r=s("filter")(t.mynotes,{id:n.id}),o=t.mynotes.indexOf(r[0]);o>-1&&t.mynotes.splice(o,1)}},function(){})}}])}),define("word/word/controller",["angular","ngSanitize","authentication/service","word/service","components/snackbar/service"],function(e){return e.module("app.word.word.controllers",["ngSanitize"]).controller("WordController",["$scope","$rootScope","Authentication","Word","$stateParams","Snackbar","WordOptions",function(e,t,n,r,o,a,c){function i(e,t){var n=null;return t&&e.forEach(function(e,r){e.id!=t||n||(n=e)}),n}t.$watch("currentUser",function(n,r){e.user=t.currentUser}),t.$watch("currentUser",function(n,r){e.user=t.currentUser,c.getWordOptions().then(function(t){e.options=t,e.word_num=i(t.word_num,e.user.word_num)||{}})})}])}),define("layout/navbar/controller",["angular","authentication/service"],function(e){return e.module("app.layout.controllers",[]).controller("NavbarController",["$rootScope","$scope","$state","Authentication",function(e,t,n,r){var o=this;o.logout=function(){r.logout()},o.searchWord=function(){Word.serachWord(o.words).then(function(e){})},e.$watch("currentUser",function(t,n){o.user=e.currentUser,o.is_authenticate=e.currentUser})}])}),define("app",["angular","ngAnimate","uiBootstrapTpls","layout/app","authentication/app","app/account","app/routes","components/module","app/word"],function(e){return e.module("app",["ui.bootstrap","app.routes","ngAnimate","app.authentication","app.layout","app.components","app.account","app.word"])}),define("app/routes",["angular","uiRouter"],function(e){e.module("app.routes",["ui.router"]).config(function(e,t){e.state("register",{url:"/register",controller:"RegisterController",controllerAs:"vm",templateUrl:"/static/templates/authentication/register.html"}).state("login",{url:"/login?redirect",controller:"LoginController",controllerAs:"loginCtrl",templateUrl:"/static/templates/authentication/login.html"}).state("settings",{url:"/settings",templateUrl:"/static/templates/account/settings.html"}).state("settings.word",{url:"/word",templateUrl:"/static/templates/account/settings/settings-word.html",controller:"WordSettingController"}).state("settings.avatar",{url:"/avatar",templateUrl:"/static/templates/account/settings/settings-avatar.html",controller:"AvatarController"}).state("settings.password",{url:"/password",templateUrl:"/static/templates/account/settings/settings-password.html",controller:"PassWordController"}).state("settings.feedback",{url:"/feedback",templateUrl:"/static/templates/account/settings/settings-feedback.html"}).state("search",{url:"/search?search",templateUrl:"/static/templates/course/explore.html",controller:"SearchController"}).state("word",{url:"/word",templateUrl:"/static/templates/word/word.html",controller:"WordController"}).state("detail",{url:"/detail",templateUrl:"/static/templates/word/detail.html",controller:"WordDetailController"}),t.otherwise("login")})}),requirejs.config({paths:{underscore:"/static/build/underscore",jquery:"/static/build/jquery",angular:"/static/build/angular",uiBootstrap:"/static/build/uiBootstrap",uiBootstrapTpls:"/static/build/uiBootstrapTpls",cropper:"/static/build/cropper.min",ngAnimate:"/static/build/ngAnimate",ngAria:"/static/build/ngAria",ngCookies:"/static/build/ngCookies",ngSanitize:"/static/build/angular-sanitize",app:"/static/javascripts/app",snackbar:"/static/build/snackbar.min"},shim:{angular:{deps:["jquery"],exports:"angular"},uiBootstrapTpls:["angular","uiBootstrap"],uiBootstrap:["angular","ngAnimate","ngAria"],ngAnimate:["angular"],ngAria:["angular"],ngSanitize:["angular"],uiRouter:["angular"],ngCookies:["angular"],cropper:["jquery"],snackbar:["jquery"],underscore:{exports:"_"}}}),require(["app"],function(){angular.element().ready(function(){$.get("/account/currentuser/").success(function(e,t){var n=e,r=angular.module("app");r.run(["Authentication","$http","$rootScope",function(e,t,r){t.defaults.xsrfHeaderName="X-CSRFToken",t.defaults.xsrfCookieName="csrftoken",r.currentUser=n,e.setCurrentUser(n)}]),angular.bootstrap(document,["app"])}).error(function(e){var t="",n=angular.module("app");n.run(["Authentication","$http","$rootScope","$state",function(e,n,r,o){n.defaults.xsrfHeaderName="X-CSRFToken",n.defaults.xsrfCookieName="csrftoken",r.currentUser=t,e.setCurrentUser(t),o.go("login")}]),angular.bootstrap(document,["app"])})})}),define("main",[],function(){});